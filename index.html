<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>碳 Bee - 永續生活首頁</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="css/index.css">
</head>
<body>

    <div id="site-nav"></div>

    <div class="container">
        <div class="kpi-row">
            <div class="kpi-card">
                <div class="kpi-title">碳幣餘額</div>
                <div class="kpi-value">1,250<span class="kpi-unit">Bee</span></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">全體民眾減碳成果</div>
                <div class="kpi-value">314,519<span class="kpi-unit">kg CO2e</span></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">連續減碳累積天數</div>
                <div class="kpi-value">15<span class="kpi-unit">Days</span></div>
            </div>
        </div>

        <div class="main-grid">
            <div class="box">
                <h3>進七天搭乘大眾交通工具的減碳趨勢</h3>
                <p class="small">統計區間：12/25 (四) - 12/31 (三)</p>
                <div class="chart-wrapper">
                    <div style="position: relative; height:300px; width:100%; margin-top: 20px;">
                        <canvas id="carbonChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="box">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">每週任務進度</h3>
                    <a href="html/tasks.html" style="color: #10b981; text-decoration: none; font-size: 0.9rem; font-weight: 600;">查看全部 ></a>
                </div>
                
                <div id="home-tasks-summary" style="max-height: 280px; overflow-y: auto; padding-right: 5px;">
                    </div>

                <hr style="border: none; border-top: 1px solid #e6f7ee; margin: 15px 0;">
            </div>
        </div>

        <div class="slider-container">
        <div class="slider-wrapper" id="sliderWrapper">
            <div class="slide">
                <img src="image/t1.png" alt="廣告 1">
            </div>
            <div class="slide">
                <img src="image/t2.png" alt="廣告 2">
            </div>
            <div class="slide">
                <img src="image/t3.png" alt="廣告 3">
            </div>
        </div>

        <button class="nav-btn prev" id="prevBtn">&#10094;</button>
        <button class="nav-btn next" id="nextBtn">&#10095;</button>
        <div class="dots-container" id="dotsContainer"></div>
        
    </div>
    </div>

    <script>
      const ctx = document.getElementById('carbonChart').getContext('2d');
      
      // 假資料：12/25 (四) ~ 12/31 (三)
      const labels = ['12/25 (四)', '12/26 (五)', '12/27 (六)', '12/28 (日)', '12/29 (一)', '12/30 (二)', '今日 12/31 (三)'];
      const dataValues = [4.2, 3.8, 1.5, 0.8, 4.5, 4.1, 3.9]; // 單位：kg CO2e

      new Chart(ctx, {
          type: 'line',
          data: {
              labels: labels,
              datasets: [{
                    label: '碳排放量 (kg)',
                    data: [4.2, 3.9, 1.2, 0.5, 4.8, 4.3, 3.8],
                    borderColor: '#10b981', // 實色綠色線條
                    backgroundColor: 'transparent', // 移除漸層填充
                    borderWidth: 4, // 讓線條粗一點，比較酷
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#10b981',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    tension: 0.4 // 保持流暢的曲線
               }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                  y: {
                      beginAtZero: true,
                      max: 6,
                      grid: { color: '#e6f7ee' }
                  },
                  x: {
                      grid: { display: false }
                  }
              },
              plugins: {
                  legend: { display: false }, // 隱藏標籤，讓畫面更乾淨
                  tooltip: {
                      callbacks: {
                          label: function(context) {
                              return `碳排量: ${context.parsed.y} kg`;
                          }
                      }
                  }
              }
          }
      });
  </script>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script src="js/swiper.js"></script>

    <script src="js/nav.js"></script>
    <script>
        const wrapper = document.getElementById('sliderWrapper');
        const slides = document.querySelectorAll('.slide');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const dotsContainer = document.getElementById('dotsContainer');
    
        let currentIndex = 0;
        const totalSlides = slides.length;
        let autoPlayInterval;
    
        // 初始化分頁點
        slides.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.classList.add('dot');
            if (i === 0) dot.classList.add('active');
            dot.addEventListener('click', () => {
                goToSlide(i);
                resetAutoPlay();
            });
            dotsContainer.appendChild(dot);
        });
    
        const dots = document.querySelectorAll('.dot');
    
        function updateSlider() {
            wrapper.style.transform = `translateX(-${currentIndex * 100}%)`;
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === currentIndex);
            });
        }
    
        function nextSlide() {
            currentIndex = (currentIndex + 1) % totalSlides;
            updateSlider();
        }
    
        function prevSlide() {
            currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
            updateSlider();
        }
    
        nextBtn.addEventListener('click', () => {
            nextSlide();
            resetAutoPlay();
        });
    
        prevBtn.addEventListener('click', () => {
            prevSlide();
            resetAutoPlay();
        });
    
        function startAutoPlay() {
            autoPlayInterval = setInterval(nextSlide, 5000);
        }
    
        function resetAutoPlay() {
            clearInterval(autoPlayInterval);
            startAutoPlay();
        }
    
        startAutoPlay();  
    </script>
    <script>
    // 修正：將任務資料擴充為完整的五個任務
    const homeTasks = [
        { title: '通勤達人', desc: '本週搭乘大眾運輸 5 次', progress: 3, target: 5 },
        { title: '堅持到底', desc: '連續 3 天搭乘大眾運輸', progress: 3, target: 3 },
        { title: '綠色騎士', desc: '騎乘 YouBike 累計 10 公里', progress: 8.5, target: 10 },
        { title: '早鳥行動', desc: '早上 8 點前完成一次打卡', progress: 0, target: 1 },
        { title: '推廣大使', desc: '邀請 1 位好友加入平台', progress: 1, target: 1 }
    ];

    function renderHomeTasks() {
        const container = document.getElementById('home-tasks-summary');
        container.innerHTML = '';

        homeTasks.forEach(task => {
            const isCompleted = task.progress >= task.target;
            const percent = Math.min((task.progress / task.target) * 100, 100);
            
            const taskHtml = `
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem;">
                        <span style="font-weight: 600; color: #064e3b;">${task.title} ${isCompleted ? '✅' : ''}</span>
                        <span style="color: #64748b;">${task.progress}/${task.target}</span>
                    </div>
                    <div style="height: 8px; background: #e6f7ee; border-radius: 4px; overflow: hidden;">
                        <div style="width: ${percent}%; height: 100%; background: ${isCompleted ? '#10b981' : '#34d399'}; transition: width 0.5s;"></div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', taskHtml);
        });
    }

    // 執行渲染
    renderHomeTasks();
</script>
</body>
</html>